---
- name: Apt Configuration Verify
  hosts: all
  gather_facts: false

  tasks:
    - name: Gather package facts
      ansible.builtin.package_facts:

    - name: Verify packages are installed
      ansible.builtin.assert:
        that:
          - "'apt-utils' in ansible_facts.packages"
          - "'curl' in ansible_facts.packages"
          - "'wget' in ansible_facts.packages"
          - "'apt-transport-https' in ansible_facts.packages"
          - "'dirmngr' in ansible_facts.packages"

    - name: Sources.list config file should be managed by Ansible
      ansible.builtin.lineinfile:
        path: /etc/apt/sources.list
        line: "# Ansible managed: Do NOT edit this file manually!"
        backup: no
      check_mode: yes
      register: conf
      failed_when: (conf is changed) or (conf is failed)

    - name: Apt defaults config file should be managed by Ansible
      ansible.builtin.lineinfile:
        path: /etc/apt/apt.conf.d/90custom-defaults
        line: "// Ansible managed: Do NOT edit this file manually!"
        backup: no
      check_mode: yes
      register: conf
      failed_when: (conf is changed) or (conf is failed)
